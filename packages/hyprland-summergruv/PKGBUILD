pkgname=hyprland-summergruv
_pkgname=dots-hyprland
_theme=dots-summergruv
pkgver=287.b05be139
pkgrel=1
pkgdesc="Hyprland Summer Gruv configuration."
arch=('any')
url='https://github.com/end-4/dots-hyprland'
license=("GPL")
depends=('athena-gruvbox-theme' 'bc' 'blueberry' 'bluez' 'boost' 'boost-libs' 'cava' 'coreutils' 'dunst' 'eww-wayland' 'findutils' 'foot' 'gawk' 'geticons-git' 'gnome-keyring' 'gnome-system-monitor' 'gojq' 'grim' 'gtklock-playerctl-module' 'gtklock-powerbar-module' 'gtklock-userinfo-module' 'hyprland-nvidia' 'ibus' 'imagemagick' 'libinput-gestures' 'libqalculate' 'light' 'nautilus' 'nerd-fonts-noto-sans-mono-extended' 'network-manager-applet' 'networkmanager' 'nlohmann-json' 'noto-fonts-emoji' 'pavucontrol' 'pipewire' 'pipewire-pulse' 'playerctl' 'polkit-gnome' 'procps' 'python-desktop-entry-lib' 'python-material-color-utilities' 'python-pywal' 'ripgrep' 'slurp' 'socat' 'sox' 'swaybg' 'swayidle' 'udev' 'upower' 'util-linux' 'wget' 'wireplumber' 'wl-clipboard' 'wlogout' 'wofi')
makedepends=('git')
source=("git+https://github.com/end-4/$_pkgname"
        "$_theme::git+https://github.com/end-4/$_pkgname#branch=summer-gruv"
        "keybinds.conf"
        "hyprland-config.sh"
        ".flag-work-once")
sha512sums=('SKIP'
            'SKIP'
            '74c0bef6265cc218eb88dca9069f9ebe96c359e61ae1b214ff203da451eafd2a1c6b7390ee8465326ef363436402ebb2af1e2eaadc9e6895112ddd6bfa216b69'
            '975d76f3cd0cad2050a0c2410fc3abfa396983a242ed1f834e0e4c91cd80c106de03177b4a5f59289a5428feb3f67388d4e6b7e160030becb559aa18410050b6'
            'cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e')

pkgver() {
  cd $_pkgname

  echo $(git rev-list --count HEAD).$(git rev-parse --short HEAD)
}

package() {

  install -dm 755 "$pkgdir/etc/profile.d/"
  install -dm 755 "$pkgdir/etc/skel/.config"
  install -dm 755 "$pkgdir/etc/skel/.local/share"
  install -dm 755 "$pkgdir/etc/skel/.themes"
  install -dm 755 "$pkgdir/usr/bin"
  install -dm 755 "$pkgdir/usr/share/gnome-text-editor/styles"
  
  cd $_pkgname

  rsync -av --progress ./.config/dunst "$pkgdir/etc/skel/.config/"
  rsync -av --progress ./.config/eww "$pkgdir/etc/skel/.config/"
  rsync -av --progress ./.config/foot "$pkgdir/etc/skel/.config/"
  rsync -av --progress ./.config/gtk-3.0 "$pkgdir/etc/skel/.config/"
  rsync -av --progress ./.config/gtk-4.0 "$pkgdir/etc/skel/.config/"
  rsync -av --progress ./.config/gtklock "$pkgdir/etc/skel/.config/"
  rsync -av --progress ./.config/hypr "$pkgdir/etc/skel/.config/"
  rsync -av --progress ./.config/mpv "$pkgdir/etc/skel/.config/"
  rsync -av --progress ./.config/waybar "$pkgdir/etc/skel/.config/"
  rsync -av --progress ./.config/wlogout "$pkgdir/etc/skel/.config/"
  rsync -av --progress ./.config/starship.toml "$pkgdir/etc/skel/.config/"
  rsync -av --progress ./.local/bin "$pkgdir/etc/skel/.local/"
  rsync -av --progress ./.local/share/fonts "$pkgdir/etc/skel/.local/share/"
  #rsync -av --progress ./.themes/ "$pkgdir/etc/skel/.themes/"
  rsync -av --progress "./Import Manually/execs (add to path)/" "$pkgdir/etc/skel/.local/bin/"
  rsync -av --progress "./Import Manually/gnome-text-editor themes (Paste to root)/usr/share/gnome-text-editor/styles/" "$pkgdir/usr/share/gnome-text-editor/styles/"

  install -Dm 755 $srcdir/hyprland-config.sh "$pkgdir/etc/profile.d/"
  install -Dm 644 $srcdir/keybinds.conf "$pkgdir/etc/skel/.config/hypr/"
  install -Dm 644 $srcdir/.flag-work-once "$pkgdir/etc/skel/"

  cd $srcdir/$_theme
  
  #rsync -av --progress ./.themes/Gruvbox-Dark-BL-LB "$pkgdir/etc/skel/.themes/"
  rsync -av --progress .config/hypr/colors.conf "$pkgdir/etc/skel/.config/hypr/" #Apply window border colors
  rsync -av --progress .config/eww/css "$pkgdir/etc/skel/.config/eww/" #Apply Gruvbox top bar colors
  rsync -av --progress .config/eww/images "$pkgdir/etc/skel/.config/eww/" #Apply Gruvbox top bar icon colors and wallpaper
  rsync -av --progress .config/foot "$pkgdir/etc/skel/.config/" #Apply Gruvbox theme to foot
  rsync -av --progress .config/dunst "$pkgdir/etc/skel/.config/" #Apply Gruvbox theme to dunst


  sed -i "/^clipboard-copy/d" "$pkgdir/etc/skel/.config/foot/foot.ini" #Removing ctrl+c mapping
  sed -i "/^clipboard-paste/d" "$pkgdir/etc/skel/.config/foot/foot.ini" #Removing ctrl+v mapping

  cat > "$pkgdir/usr/bin/$pkgname" << EOF
#!/bin/sh
echo "Creation of backup directory of configuration folders..."

theme_name="Gruvbox-Dark-BL"
cursor_theme="Fuchsia-Pop"

DIR=\$HOME/.config/hypr
if [[ -d "\$DIR" ]]; then
  rm -rf \$HOME/.config/hypr.bak
  mv \$HOME/.config/hypr \$HOME/.config/hypr.bak
fi

DIR=\$HOME/.config/foot
if [[ -d "\$DIR" ]]; then
  rm -rf \$HOME/.config/foot.bak
  mv \$HOME/.config/foot \$HOME/.config/foot.bak
fi

echo "Saved as \$HOME/.config/<dirname>.bak."
echo
echo "Copying configuration files to user's home folder..."

cp -rf /etc/skel/.config/dunst /etc/skel/.config/eww /etc/skel/.config/foot /etc/skel/.config/gtk-3.0 /etc/skel/.config/gtk-4.0 /etc/skel/.config/gtklock /etc/skel/.config/hypr /etc/skel/.config/mpv /etc/skel/.config/waybar /etc/skel/.config/wlogout /etc/skel/.config/starship.toml \$HOME/.config/

cp -rf /etc/skel/.local/bin \$HOME/.local/

cp -rf /etc/skel/.local/share/fonts /etc/skel/.local/share/icons \$HOME/.local/share/

cp -rf /etc/skel/.config/dunst \$HOME/.config/
cp -rf /etc/skel/.config/foot \$HOME/.config/

cp -rf /etc/skel/.config/gtk-3.0 \$HOME/.config/
cp -rf /etc/skel/.config/gtk-4.0 \$HOME/.config/

cp -rf /etc/skel/.themes/Gruvbox-Dark-BL-LB \$HOME/.themes/

gsettings set org.gnome.desktop.interface gtk-theme \$theme_name
gsettings set org.gnome.desktop.wm.preferences theme \$theme_name
gsettings set org.gnome.desktop.interface cursor-theme \$cursor_theme

echo "Done. Reboot the system for applying the theme."
EOF

  chmod +x "$pkgdir/usr/bin/$pkgname"
}
