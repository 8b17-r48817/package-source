#!/bin/bash

menu_options=("Border" "Borderless" "Exit")

function print_menu() {
    echo ""
    for ((i=0; i<${#menu_options[@]}; i++)); do
        echo "$((i+1)) -- ${menu_options[i]}"
    done
}

function menu() {
    while true; do
        print_menu
        option=""
        read -p "Would you like to have Border or Borderless theme? " option
        case "$option" in
            1)
                border=1
                return $border
                ;;
            2)
                border=0
                return $border
                ;;
            3)
                echo "Exiting..."
                exit
                ;;
            *)
                echo "Invalid option. Please enter a number between 1 and 3."
                ;;
        esac
    done
}

rm -rf "$HOME/.config/assets"
rm -rf "$HOME/.config/gtk-4.0"
mkdir -p "$HOME/.config/gtk-4.0"

menu 

if [ "$border" -eq 1 ]; then
    theme_name="Graphite-Dark"
    gnome_shell="Graphite-Dark"
else
    theme_name="Graphite-Rimless-Dark"
    gnome_shell="Graphite-Rimless-Dark"
fi

color_scheme="prefer-dark"
icon_theme="Tela-circle-black-dark"
cursor_theme="Bibata-Modern-Ice"
background_theme="/usr/share/backgrounds/default/arch-ascii.png"
picture_options="stretched"
vscode_theme="Just Black"
kitty_theme="Atom.conf"
tmux_theme="snow"

topbarcolorscheme="nowthatitstrue"
topbarmaterialscheme="default"
topbariconscheme="dark"
musicbarscheme="#197FAF"

gsettings set org.gnome.desktop.interface gtk-theme ""
gsettings set org.gnome.desktop.wm.preferences theme ""
gsettings set org.gnome.shell.extensions.user-theme name ""
sleep 1
gsettings set org.gnome.desktop.interface gtk-theme "$theme_name"
gsettings set org.gnome.desktop.wm.preferences theme "$theme_name"
gsettings set org.gnome.shell.extensions.user-theme name "$gnome_shell" 2>/dev/null

ln -sf "/usr/share/themes/$theme_name/gtk-4.0/assets" "$HOME/.config/gtk-4.0/assets"
ln -sf "/usr/share/themes/$theme_name/gtk-4.0/gtk.css" "$HOME/.config/gtk-4.0/gtk.css"
ln -sf "/usr/share/themes/$theme_name/gtk-4.0/gtk-dark.css" "$HOME/.config/gtk-4.0/gtk-dark.css"
ln -sf "/usr/share/themes/$theme_name/assets" "$HOME/.config/assets"

gsettings set org.gnome.desktop.interface color-scheme "$color_scheme"
gsettings set org.gnome.desktop.interface icon-theme "$icon_theme"
gsettings set org.gnome.desktop.interface cursor-theme "$cursor_theme"
gsettings set org.gnome.desktop.background picture-uri-dark ""
gsettings set org.gnome.desktop.background picture-uri-dark "file://$background_theme"
gsettings set org.gnome.desktop.background picture-uri ""
gsettings set org.gnome.desktop.background picture-uri "file://$background_theme"
gsettings set org.gnome.desktop.background picture-options "$picture_options"

sed -i "s/\"workbench.colorTheme\":.*/\"workbench.colorTheme\": \"$vscode_theme\",/g" "$HOME/.config/VSCodium/User/settings.json"
cp -rf "$HOME/.config/kitty/kitty-themes/themes/$kitty_theme" "$HOME/.config/kitty/current-theme.conf" 2>/dev/null
sed -i "s/set -g @tmux_power_theme.*/set -g @tmux_power_theme '$tmux_theme'/g" "$HOME/.tmux.conf"

if [ -n "$HYPRLAND_INSTANCE_SIGNATURE" ]; then
    cp -rf "$HOME/.config/eww/css/savedcolors/_colorscheme_$topbarcolorscheme.scss" "$HOME/.config/eww/css/_colorscheme.scss" 2>/dev/null
    cp -rf "$HOME/.config/eww/css/savedcolors/_iconcolor_$topbarcolorscheme.txt" "$HOME/.config/eww/css/_iconcolor.txt" 2>/dev/null
    cp -rf "$HOME/.config/eww/css/savedcolors/_material_$topbarmaterialscheme.scss" "$HOME/.config/eww/css/_material.scss" 2>/dev/null
    cp -rf "$HOME/.config/eww/images/svg/$topbariconscheme/"* "$HOME/.config/eww/images/svg/" 2>/dev/null
    cp -rf "$HOME/.config/hypr/savedcolors/colors_$topbarcolorscheme.conf" "$HOME/.config/hypr/colors.conf" 2>/dev/null
    cp -rf "$background_theme" "$HOME/.config/eww/images/wallpaper/wallpaper" 2>/dev/null
    pkill swaybg 2>/dev/null
    swaybg -i "$HOME/.config/eww/images/wallpaper/wallpaper" 2>/dev/null &
    sed -r -i "s/\"color4\":\"#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})\"/\"color4\":\"$musicbarscheme\"/g" "$HOME/.config/eww/scripts/music" 2>/dev/null
fi
