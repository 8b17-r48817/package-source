#!/bin/bash

rm -rf "$HOME/.config/assets"
rm -rf "$HOME/.config/gtk-4.0"
mkdir -p "$HOME/.config/gtk-4.0"

theme_name="HackTheBox-BBL"
gnome_shell="HackTheBox-BBL"

#theme_name="HackTheBox-BL"
#gnome_shell="HackTheBox-BL"

#theme_name="HackTheBox-B"
#gnome_shell="HackTheBox-B"

color_scheme="prefer-dark"
icon_theme="HackTheBox"
cursor_theme="Afterglow-Dracula-Green"
background_theme="/usr/share/backgrounds/default/hackthebox.png"
picture_options="stretched"
vscode_theme="Hack The Box"
kitty_theme="Box.conf"
tmux_theme="forest"
topbarcolorscheme="finale"
topbarmaterialscheme="finale"
topbariconscheme="dark"
musicbarscheme="#9fef00"

gsettings set org.gnome.desktop.interface gtk-theme ""
gsettings set org.gnome.desktop.wm.preferences theme ""
gsettings set org.gnome.shell.extensions.user-theme name ""
sleep 1
gsettings set org.gnome.desktop.interface gtk-theme "$theme_name"
gsettings set org.gnome.desktop.wm.preferences theme "$theme_name"
gsettings set org.gnome.shell.extensions.user-theme name "$gnome_shell" 2>/dev/null

ln -sf "/usr/share/themes/$theme_name/gtk-4.0/assets" "$HOME/.config/gtk-4.0/assets"
ln -sf "/usr/share/themes/$theme_name/gtk-4.0/gtk.css" "$HOME/.config/gtk-4.0/gtk.css"
ln -sf "/usr/share/themes/$theme_name/gtk-4.0/gtk-dark.css" "$HOME/.config/gtk-4.0/gtk-dark.css"
ln -sf "/usr/share/themes/$theme_name/assets" "$HOME/.config/assets"

gsettings set org.gnome.desktop.interface color-scheme "$color_scheme"
gsettings set org.gnome.desktop.interface icon-theme "$icon_theme"
gsettings set org.gnome.desktop.interface cursor-theme "$cursor_theme"
gsettings set org.gnome.desktop.background picture-uri-dark ""
gsettings set org.gnome.desktop.background picture-uri-dark "file://$background_theme"
gsettings set org.gnome.desktop.background picture-uri ""
gsettings set org.gnome.desktop.background picture-uri "file://$background_theme"
gsettings set org.gnome.desktop.background picture-options "$picture_options"

sed -i "s/\"workbench.colorTheme\":.*/\"workbench.colorTheme\": \"$vscode_theme\",/g" "$HOME/.config/VSCodium/User/settings.json"
cp -rf "$HOME/.config/kitty/kitty-themes/themes/$kitty_theme" "$HOME/.config/kitty/current-theme.conf" 2>/dev/null
sed -i "s/set -g @tmux_power_theme.*/set -g @tmux_power_theme '$tmux_theme'/g" "$HOME/.tmux.conf"

# Create a for loop with one sed here:

# Define arrays for strings to be replaced and their replacements
declare -a original_strings=(
  '\\\"\/usr\/share\/icons\/hicolor\/128x128\/categories\/redteam-128x128.png\\\"'
  '\\\"\/usr\/share\/icons\/hicolor\/128x128\/categories\/blueteam-128x128.png\\\"'
  '\\\"\/usr\/share\/icons\/hicolor\/128x128\/categories\/sociable-128x128.png\\\"'
  '\\\"\/usr\/share\/icons\/hicolor\/256x256\/apps\/terminal-256x256.png\\\"'
  '\\\"\/usr\/share\/icons\/hicolor\/256x256\/apps\/firefox_logo_arch-256x256.png\\\"'
  '\\\"\/usr\/share\/icons\/hicolor\/256x256\/apps\/vscode-256x256.png\\\"'
  '\\\"\/usr\/share\/icons\/hicolor\/256x256\/categories\/athena-info-gathering-trans-256x256.png\\\"'
  '\\\"\/usr\/share\/icons\/hicolor\/256x256\/categories\/athena-vuln-analysis-256x256.png\\\"'
  '\\\"\/usr\/share\/icons\/hicolor\/256x256\/categories\/athena-web-application-trans-256x256.png\\\"'
  '\\\"\/usr\/share\/icons\/hicolor\/256x256\/categories\/athena-password-attacks-trans-256x256.png\\\"'
  '\\\"\/usr\/share\/icons\/hicolor\/256x256\/categories\/athena-sniffing-spoofing-trans-256x256.png\\\"'
  '\\\"\/usr\/share\/icons\/hicolor\/256x256\/categories\/athena-wireless-attacks-trans-256x256.png\\\"'
  '\\\"\/usr\/share\/icons\/hicolor\/256x256\/categories\/athena-reverse-engineering-trans-256x256.png\\\"'
  '\\\"\/usr\/share\/icons\/hicolor\/256x256\/categories\/athena-exploitation-tools-trans-256x256.png\\\"'
  '\\\"\/usr\/share\/icons\/hicolor\/256x256\/categories\/athena-maintaining-access-trans-256x256.png\\\"'
  # Blue
  '\\\"\/usr\/share\/icons\/hicolor\/categories\/athena-identify-trans.svg\\\"'
  '\\\"\/usr\/share\/icons\/hicolor\/categories\/athena-protect-trans.svg\\\"'
  '\\\"\/usr\/share\/icons\/hicolor\/categories\/athena-detect-trans.svg\\\"'
  '\\\"\/usr\/share\/icons\/hicolor\/categories\/athena-respond-trans.svg\\\"'
  '\\\"\/usr\/share\/icons\/hicolor\/categories\/athena-recover-trans.svg\\\"'
)

declare -a replacement_strings=(
  '\\\"\/usr\/share\/icons\/HackTheBox\/categories\/scalable\/redteam.svg\\\"'
  '\\\"\/usr\/share\/icons\/HackTheBox\/categories\/scalable\/blueteam.svg\\\"'
  '\\\"\/usr\/share\/icons\/HackTheBox\/categories\/scalable\/social.svg\\\"'
  '\\\"\/usr\/share\/icons\/HackTheBox\/apps\/scalable\/terminal.svg\\\"'
  '\\\"\/usr\/share\/icons\/HackTheBox\/apps\/scalable\/firefox_logo_arch.svg\\\"'
  '\\\"\/usr\/share\/icons\/HackTheBox\/apps\/scalable\/vscode.svg\\\"'
  '\\\"\/usr\/share\/icons\/HackTheBox\/categories\/scalable\/athena-info-gathering-trans.svg\\\"'
  '\\\"\/usr\/share\/icons\/HackTheBox\/categories\/scalable\/athena-vuln-analysis.svg\\\"'
  '\\\"\/usr\/share\/icons\/HackTheBox\/categories\/scalable\/athena-web-application-trans.svg\\\"'
  '\\\"\/usr\/share\/icons\/HackTheBox\/categories\/scalable\/athena-password-attacks-trans.svg\\\"'
  '\\\"\/usr\/share\/icons\/HackTheBox\/categories\/scalable\/athena-sniffing-spoofing-trans.svg\\\"'
  '\\\"\/usr\/share\/icons\/HackTheBox\/categories\/scalable\/athena-wireless-attacks-trans.svg\\\"'
  '\\\"\/usr\/share\/icons\/HackTheBox\/categories\/scalable\/athena-reverse-engineering-trans.svg\\\"'
  '\\\"\/usr\/share\/icons\/HackTheBox\/categories\/scalable\/athena-exploitation-tools-trans.svg\\\"'
  '\\\"\/usr\/share\/icons\/HackTheBox\/categories\/scalable\/athena-maintaining-access-trans.svg\\\"'
  # Blue
  '\\\"\/usr\/share\/icons\/HackTheBox\/categories\/scalable\/athena-identify-trans.svg\\\"'
  '\\\"\/usr\/share\/icons\/HackTheBox\/categories\/scalable\/athena-protect-trans.svg\\\"'
  '\\\"\/usr\/share\/icons\/HackTheBox\/categories\/scalable\/athena-detect-trans.svg\\\"'
  '\\\"\/usr\/share\/icons\/HackTheBox\/categories\/scalable\/athena-respond-trans.svg\\\"'
  '\\\"\/usr\/share\/icons\/HackTheBox\/categories\/scalable\/athena-recover-trans.svg\\\"'
)

# Define an array of file paths
declare -a file_paths=(
  '/usr/share/athena-gnome-config/dconf-shell.ini'
  '/usr/share/athena-gnome-material-shell-config/dconf-shell.ini'
)

# Iterate through the array of file paths
for ((i = 0; i < ${#file_paths[@]}; i++)); do
  path="${file_paths[i]}"
  
  # Construct the sed command
  sed_cmd="sudo sed -i"

  # Iterate through the original_strings and replacement_strings arrays
  for ((j = 0; j < ${#original_strings[@]}; j++)); do
    original="${original_strings[j]}"
    replacement="${replacement_strings[j]}"
    sed_cmd+=" -e 's/$original/$replacement/g'"
  done

  sed_cmd+=" '$path"

  # Execute the constructed sed command, redirecting stderr to null
  eval "$sed_cmd" 2>/dev/null

  # Additional sed because idk why it is not able to change the icon path if I put this in for loop above
  sudo sed -i "s/\\\\\"\/usr\/share\/icons\/hicolor\/256x256\/categories\/athena-vuln-analysis-256x256.png\\\\\"/\\\\\"\/usr\/share\/icons\/HackTheBox\/categories\/scalable\/athena-vuln-analysis.svg\\\\\"/g" /usr/share/athena-gnome-config/dconf-shell.ini /usr/share/athena-gnome-material-shell-config/dconf-shell.ini 2>/dev/null
done

dconf load /org/gnome/shell/ < /usr/share/athena-gnome-config/dconf-shell.ini

if [ -n "$HYPRLAND_INSTANCE_SIGNATURE" ]; then
    cp -rf "$HOME/.config/eww/css/savedcolors/_colorscheme_$topbarcolorscheme.scss" "$HOME/.config/eww/css/_colorscheme.scss" 2>/dev/null
    cp -rf "$HOME/.config/eww/css/savedcolors/_iconcolor_$topbarcolorscheme.txt" "$HOME/.config/eww/css/_iconcolor.txt" 2>/dev/null
    cp -rf "$HOME/.config/eww/css/savedcolors/_material_$topbarmaterialscheme.scss" "$HOME/.config/eww/css/_material.scss" 2>/dev/null
    cp -rf "$HOME/.config/eww/images/svg/$topbariconscheme/"* "$HOME/.config/eww/images/svg/" 2>/dev/null
    cp -rf "$HOME/.config/hypr/savedcolors/colors_$topbarcolorscheme.conf" "$HOME/.config/hypr/colors.conf" 2>/dev/null
    cp -rf "$background_theme" "$HOME/.config/eww/images/wallpaper/wallpaper" 2>/dev/null
    pkill swaybg 2>/dev/null
    swaybg -i "$HOME/.config/eww/images/wallpaper/wallpaper" 2>/dev/null &
    sed -r -i "s/\"color4\":\"#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})\"/\"color4\":\"$musicbarscheme\"/g" "$HOME/.config/eww/scripts/music" 2>/dev/null
fi
